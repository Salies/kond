<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Z-Score Bar Chart</title>
    <style>
        body {
            background-color: hsl(254, 12%, 6%);
            color: #F8F8F2;
        }

      .chart-container {
        display: flex;
        justify-content: center;
        align-items: flex-end;
        height: 120px; /* Adjust height as needed */
        /*border-left: 2px solid black;
        border-bottom: 2px solid black;*/
        width: 600px;
        position: relative;
        overflow: hidden; /*hides negative bars that go below the zero line*/
        margin-top:20px;
      }

      .bar {
        width: 80px;
        margin: 0 5px;
        background-color: RGB(139, 233, 253);
        transition: height 0.3s ease;
      }

      .zero-line {
        position: absolute;
        width: 95%;
        height: 1px;
        background-color: RGBA(248, 248, 242, 0.75);
        z-index: 999;
        left: 0;
        bottom: 50%;
      }
      
      .zero-line::after{
        content:"Avg";
        width: 30px;
        position: absolute;
        top:-10px;
        background: hsl(254, 12%, 6%);
      }

      .legend {
        display: flex;
        padding-left:30px;
      }

      .legend > div {
        width:80px;
        margin: 0 5px;
        text-align: center;
        display: flex;
        height:60px;
        flex-flow:column;
        background-color: red;
        border-radius: 10px;
        margin-top: 0.25rem;
        overflow: hidden;
      }

      .legend > div > span {
        display: flex;
        height: 100%;
        justify-content: center;
        align-items: center;
      }

      .legend > div > span:first-of-type {
        font-weight: 900;
        background-color: RGB(68, 71, 90);
      }

      .legend > div > span:last-of-type {
        background-color: RGB(40, 42, 54);
      }
    </style>
  </head>
  <body>
    <div class="chart-container" id="chart">
      <div class="zero-line"></div>
    </div>

    <div class="legend" id="legend"></div>

    <script>
      const bestValues = {
        kpr: 1.2857143,
        dpr: 0.2857143,
        adr: 104.57143,
        impact: 2.093661,
        kast: 0.9285714,
        rating: 1.9566289,
      };

      const avg = {
        kpr: 0.664285731,
        dpr: 0.664285714,
        kast: 0.742857143,
        impact: 1.006926247,
        adr: 72.83571409999999,
        rating: 1.045336219,
      };

      const std = {
        kpr: 0.21076875906198866,
        dpr: 0.15096626561410836,
        kast: 0.08043249110215442,
        impact: 0.45871921988594216,
        adr: 16.890184091266683,
        rating: 0.33678706821400617,
      };

      function zScore(value, avg, std) {
        return (value - avg) / std;
      }

      // Sample Z-score normalized data (these could be any real Z-scores)
      const data = new Array();
      for (const key in bestValues) {
        data.push(zScore(bestValues[key], avg[key], std[key]));
      }

      const refs = Object.keys(bestValues);

      console.log(data);

      // Get the chart container
      const chart = document.getElementById("chart");
      const legend = document.getElementById("legend");

      // Find the max absolute Z-score to scale bars properly
      const maxAbsZ = Math.max(...data.map(Math.abs));

      let i = 0;
      // Generate bars dynamically
      data.forEach((value) => {
        const bar = document.createElement("div");
        bar.classList.add("bar");
        /*let vPrint = bestValues[refs[i]].toFixed(2);
        if (refs[i] == "kast") vPrint = (bestValues[refs[i]] * 100).toFixed(1) + "%";
        if (refs[i] == "adr") vPrint = bestValues[refs[i]].toFixed(1);
        console.log(refs[i]);
        bar.innerHTML = `<span>${vPrint}</span>`; // Display Z-score on bar*/

        const barLegend = document.createElement("div");
        let vPrint = bestValues[refs[i]].toFixed(2);
        if (refs[i] == "kast") vPrint = (bestValues[refs[i]] * 100).toFixed(1) + "%";
        if (refs[i] == "adr") vPrint = bestValues[refs[i]].toFixed(1);

        barLegend.innerHTML = `<span>${refs[i]}</span><span>${vPrint}</span>`;
        legend.appendChild(barLegend);

        // Normalize height (Z-scores centered at zero)
        const barHeight = (Math.abs(value) / maxAbsZ) * 100; // Scale to fit container

        // Position bars (positive values go up, negative values go down)
        bar.style.height = `${barHeight}%`;
        bar.style.transform = `translateY(${value < 0 ? 100 - barHeight : 0}%)`; // Push negative bars downward

        // Append to chart
        chart.appendChild(bar);

        i++;
      });
    </script>
  </body>
</html>
